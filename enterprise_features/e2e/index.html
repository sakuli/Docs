<!DOCTYPE html>
<html lang="en" class="js csstransforms3d">
  <head>
    
      
      
      <script data-name="googleanalytics" data-type="application/javascript" type="text/plain">(function (w, d, s, l, i) {
                      w[l] = w[l] || []; w[l].push({
                          'gtm.start':
                              new Date().getTime(), event: 'gtm.js'
                      }); var f = d.getElementsByTagName(s)[0],
                          j = d.createElement(s), dl = l != 'dataLayer' ? '&l=' + l : ''; j.async = true; j.src =
                              'https://www.googletagmanager.com/gtm.js?id=' + i + dl; f.parentNode.insertBefore(j, f);
                  })(window, document, 'script', 'dataLayer', 'GTM-TMFSKHB');</script>
      
    
    
      <script data-type="application/javascript" type="text/plain" data-src="https://app.primeleads.de/api/v1/4uewa4e9rh"
        data-name="primeLeads"></script>
    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="generator" content="Hugo 0.68.3" />
    <meta name="description" content="">


    <link rel="icon" href="/docs/images/favicon.png" type="image/png">

    <title>Sakuli</title>

    
    <link href="/docs/css/nucleus.css" rel="stylesheet">
    <link href="/docs/css/fontawesome-all.min.css" rel="stylesheet">
    <link href="/docs/css/hybrid.css" rel="stylesheet">
    <link href="/docs/css/featherlight.min.css" rel="stylesheet">
    <link href="/docs/css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="/docs/css/auto-complete.css" rel="stylesheet">
    <link href="/docs/css/atom-one-dark-reasonable.css" rel="stylesheet">
    <link href="/docs/css/theme.css" rel="stylesheet">
    <link href="/docs/css/hugo-theme.css" rel="stylesheet">
    

    <script src="/docs/js/jquery-3.3.1.min.js"></script>

    <style>
      :root #header + #content > #left > #rlblock_left{
          display:none !important;
      }
      
        :not(pre) > code + span.copy-to-clipboard {
            display: none;
        }
      
    </style>
    
  </head>
  <body class="" data-url="/docs/enterprise_features/e2e/">
    <nav id="sidebar" class="showVisitedLinks">



  <div id="header-wrapper">
    <div id="header">
      <a id="logo" href="/">
  <img src="/docs/images/sakuli_01.svg" style="width: 250px; display: block; height: auto" />
</a>

    </div>
    
        <div class="searchbox">
    <label for="search-by"><i class="fas fa-search"></i></label>
    <input data-search-input id="search-by" type="search" placeholder="Search...">
    <span data-search-clear=""><i class="fas fa-times"></i></span>
</div>

<script type="text/javascript" src="/docs/js/lunr.min.js"></script>
<script type="text/javascript" src="/docs/js/auto-complete.js"></script>
<script type="text/javascript">
    
        var baseurl = "\/docs";
    
</script>
<script type="text/javascript" src="/docs/js/search.js"></script>

    
  </div>

    <div class="highlightable">
    <ul class="topics">

        
          
          


 
  
    
    <li data-nav-id="/docs/getting-started/" title="Getting Started" class="dd-item
        
        
        
        ">
      <a href="/docs/getting-started/">
          <i class='fas fa-chevron-right'></i>  Getting Started
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/docs/getting-started/prerequisites/" title="Prerequisites" class="dd-item ">
        <a href="/docs/getting-started/prerequisites/">
        Prerequisites
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/getting-started/initialization/" title="Initialization" class="dd-item ">
        <a href="/docs/getting-started/initialization/">
        Initialization
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/getting-started/installation/" title="Installation" class="dd-item ">
        <a href="/docs/getting-started/installation/">
        Installation
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/getting-started/firsttest/" title="First Setup" class="dd-item ">
        <a href="/docs/getting-started/firsttest/">
        First Setup
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/getting-started/version-control/" title="Version control systems" class="dd-item ">
        <a href="/docs/getting-started/version-control/">
        Version control systems
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/writing_tests/" title="Writing Tests" class="dd-item
        
        
        
        ">
      <a href="/docs/writing_tests/">
          <i class='fas fa-chevron-right'></i>  Writing Tests
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/docs/writing_tests/anatomy/" title="Anatomy" class="dd-item ">
        <a href="/docs/writing_tests/anatomy/">
        Anatomy
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/writing_tests/interact/" title="Interact" class="dd-item ">
        <a href="/docs/writing_tests/interact/">
        Interact
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/writing_tests/screenshot/" title="Screenshot" class="dd-item ">
        <a href="/docs/writing_tests/screenshot/">
        Screenshot
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/writing_tests/application/" title="Native applications" class="dd-item ">
        <a href="/docs/writing_tests/application/">
        Native applications
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/writing_tests/webtests/" title="Webtests" class="dd-item ">
        <a href="/docs/writing_tests/webtests/">
        Webtests
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/writing_tests/tutorial/" title="Tutorial" class="dd-item ">
        <a href="/docs/writing_tests/tutorial/">
        Tutorial
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/writing_tests/migration-sakuli-1/" title="Migration from Sakuli 1" class="dd-item ">
        <a href="/docs/writing_tests/migration-sakuli-1/">
        Migration from Sakuli 1
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/configuring_tests/" title="Configuring Tests" class="dd-item
        
        
        
        ">
      <a href="/docs/configuring_tests/">
          <i class='fas fa-chevron-right'></i>  Configuring Tests
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/enterprise_features/" title="Enterprise Features" class="dd-item
        parent
        
        
        ">
      <a href="/docs/enterprise_features/">
          <i class='fas fa-chevron-right'></i>  Enterprise Features
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/docs/enterprise_features/icinga/" title="Icinga2 Forwarder" class="dd-item ">
        <a href="/docs/enterprise_features/icinga/">
        Icinga2 Forwarder
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/enterprise_features/prometheus/" title="Prometheus Fowarder" class="dd-item ">
        <a href="/docs/enterprise_features/prometheus/">
        Prometheus Fowarder
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/enterprise_features/check/" title="checkmk Fowarder" class="dd-item ">
        <a href="/docs/enterprise_features/check/">
        checkmk Fowarder
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/enterprise_features/omd/" title="OMD Forwarder" class="dd-item ">
        <a href="/docs/enterprise_features/omd/">
        OMD Forwarder
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/enterprise_features/e2e/" title="Container" class="dd-item active">
        <a href="/docs/enterprise_features/e2e/">
        Container
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/enterprise_features/s2i/" title="S2I Image" class="dd-item ">
        <a href="/docs/enterprise_features/s2i/">
        S2I Image
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/enterprise_features/sakuli-dashboard-deployment/" title="Sakuli Dashboard" class="dd-item ">
        <a href="/docs/enterprise_features/sakuli-dashboard-deployment/">
        Sakuli Dashboard
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/enterprise_features/sakuli-dashboard-configuration/" title="Sakuli Dashboard Configuration" class="dd-item ">
        <a href="/docs/enterprise_features/sakuli-dashboard-configuration/">
        Sakuli Dashboard Configuration
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/cli/" title="CLI" class="dd-item
        
        
        
        ">
      <a href="/docs/cli/">
          <i class='fas fa-chevron-right'></i>  CLI
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/cookbook/" title="Cookbook" class="dd-item
        
        
        
        ">
      <a href="/docs/cookbook/">
          <i class='fas fa-chevron-right'></i>  Cookbook
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/docs/cookbook/tabs/" title="Tabs" class="dd-item ">
        <a href="/docs/cookbook/tabs/">
        Tabs
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/cookbook/logging/" title="Logging" class="dd-item ">
        <a href="/docs/cookbook/logging/">
        Logging
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/cookbook/handling-forms/" title="Handling forms" class="dd-item ">
        <a href="/docs/cookbook/handling-forms/">
        Handling forms
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/cookbook/waiting/" title="Waiting" class="dd-item ">
        <a href="/docs/cookbook/waiting/">
        Waiting
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/cookbook/invalid-session-id/" title="Error: Invalid session id" class="dd-item ">
        <a href="/docs/cookbook/invalid-session-id/">
        Error: Invalid session id
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/cookbook/container/" title="Run Container" class="dd-item ">
        <a href="/docs/cookbook/container/">
        Run Container
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/cookbook/proxy/" title="Container and Proxies" class="dd-item ">
        <a href="/docs/cookbook/proxy/">
        Container and Proxies
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
            
            


 
  
    
      <li data-nav-id="/docs/cookbook/frames/" title="Frames" class="dd-item ">
        <a href="/docs/cookbook/frames/">
        Frames
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
          


 
  
    
    <li data-nav-id="/docs/change_notes/" title="Change notes" class="dd-item
        
        
        
        ">
      <a href="/docs/change_notes/">
          <i class='fas fa-chevron-right'></i>  Change notes
          
            <i class="fas fa-check read-icon"></i>
          
      </a>
      
      
        <ul>
          
          
          

        
          
            
            


 
  
    
      <li data-nav-id="/docs/change_notes/2.3.0/" title="V2.3.0" class="dd-item ">
        <a href="/docs/change_notes/2.3.0/">
        V2.3.0
        <i class="fas fa-check read-icon"></i>
        </a>
    </li>
     
  
 

            
          
        
        </ul>
      
    </li>
  
 

          
        
    </ul>

    
    

    
    <section id="prefooter">
      <hr/>
      <ul>
      


      
      <div id="apiHead" class="padding">API Docs</div>
      <ul id="apiMenu">
        <li><a href="/apidoc/sakuli-legacy" target="_blank" >@sakuli/legacy</a></li>
      </ul>

      

      <hr/>

      
        <li><a class="padding" href="#" data-clear-history-toggle=""><i class="fas fa-history fa-fw"></i> Clear History</a></li>
      
      <li>
        <a class="padding" onclick="klaro.show();return false;">
          <i class="fas fa-cog fa-fw"></i> Cookie Settings
        </a>
      </li>
      <li>
        <a class="padding" href="/dataprivacy/">
          <i class="fas fa-user-secret fa-fw"></i> Data Privacy
        </a>
      </li>
      <li>
        <a class="padding" href="/legalnotice/">
          <i class="fas fa-balance-scale fa-fw"></i> Legal Notice
        </a>
      </li>
      
      </ul>
    </section>
    
    <section id="footer">
      

    </section>
  </div>
</nav>





        <section id="body">
        <div id="overlay"></div>
        <div class="padding highlightable">
              
              <div>
                <div id="top-bar">
                
                
                <div id="breadcrumbs" itemscope="" itemtype="http://data-vocabulary.org/Breadcrumb">
                    <span id="sidebar-toggle-span">
                        <a href="#" id="sidebar-toggle" data-sidebar-toggle="">
                          <i class="fas fa-bars"></i>
                        </a>
                    </span>
                  
                  <span id="toc-menu"><i class="fas fa-list-alt" ></i></span>
                  
                  <span class="links">
                 
                 
                    
          
          
            
            
          
          
            
            
          
          
            <a href='/docs/'></a> > <a href='/docs/enterprise_features/'>Enterprise Features</a> > Container
          
        
          
        
          
        
                 
                  </span>
                </div>
                
                    <div class="progress">
    <div class="wrapper">
        <nav id="TableOfContents">
  <ul>
    <li><a href="#1-obtaining-the-image">1 Obtaining the Image</a></li>
    <li><a href="#running-sakuli-test-containers">2 Running Sakuli Test Containers</a></li>
    <li><a href="#3-anatomy-of-a-containerized-sakuli-test">3 Anatomy of a Containerized Sakuli Test</a></li>
    <li><a href="#4-configuring-a-containerized-test">4 Configuring a Containerized Test</a>
      <ul>
        <li><a href="#41-provide-the-test-project-to-the-container">4.1 Provide the test project to the container</a></li>
        <li><a href="#42-specify-the-location-of-our-test-project-inside-the-container">4.2 Specify the location of our test project inside the container</a></li>
        <li><a href="#43-configure-what-to-execute-on-npm-test">4.3 Configure what to execute on <code>npm test</code></a></li>
      </ul>
    </li>
    <li><a href="#5-viewing--configuring-test-execution">5 Viewing / Configuring Test Execution</a>
      <ul>
        <li><a href="#51-vnc-access">5.1 VNC Access</a></li>
        <li><a href="#52-configuring-vnc-access">5.2 Configuring VNC Access</a></li>
        <li><a href="#53-container-user">5.3 Container User</a></li>
      </ul>
    </li>
    <li><a href="#6-custom-certificates">6 Custom Certificates</a>
      <ul>
        <li></li>
      </ul>
    </li>
    <li><a href="#7-overview-environment-variables">7 Overview Environment Variables</a></li>
    <li><a href="#8-summary">8 Summary</a></li>
  </ul>
</nav>
    </div>
</div>

                
              </div>
            </div>
            
        <div id="head-tags">
        
        </div>
        
        <div id="body-inner">
          
            
          

        



<h1 id="pre-configured-container">Pre-configured Container</h1>
<p>Once you obtained a Sakuli Enterprise license your docker-user will be granted access to the private Sakuli test container image.
This image is ready to go and ships with already installed:</p>
<ul>
<li>Sakuli</li>
<li>Icinga2 / checkmk / OMD / Prometheus Forwarder</li>
<li>VNC / noVNC</li>
<li>Chrome / Firefox (incl. webdriver)</li>
</ul>
<h2 id="1-obtaining-the-image">1 Obtaining the Image</h2>
<p>The registered docker-hub user will then be able to pull the private image:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker pull taconsol/sakuli:&lt;IMAGE_TAG&gt;</code></pre></div>
<p>Sakuli test containers do not provide a <code>latest</code> tag.
You will always have to specify the exact version of Sakuli you intend to use in your containerized tests.</p>
<p>Containers are tagged according to Sakuli versions, so in order to use Sakuli v2.1.2 in a test, one would pull the following image:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker pull taconsol/sakuli:2.1.2</code></pre></div>
<blockquote>
<p>Sakuli does not support a latest tag. When running a containerized test one always has to specify the exact version to use to ensure consistency. You can find a list of available tags on <!-- raw HTML omitted -->Dockerhub<!-- raw HTML omitted --></p>
</blockquote>
<h2 id="running-sakuli-test-containers">2 Running Sakuli Test Containers</h2>
<p>Containerized Sakuli tests require a valid Sakuli license token which has to be provided via the <code>SAKULI_LICENSE_KEY</code> <a href="/docs/enterprise_features/#using-the-license-key">environment variable</a>.</p>
<p>Docker allows to pass environment variable along other parameters when starting a new container:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run --rm -p 5901:5901 -p 6901:6901 -e SAKULI_LICENSE_KEY<span style="color:#f92672">=</span>&lt;YOUR SAKULI LICENSE KEY&gt; <span style="color:#f92672">[</span>--shm-size<span style="color:#f92672">=</span>2G<span style="color:#f92672">]</span> taconsol/sakuli:2.1.2</code></pre></div>
<p>Parameters:</p>
<ul>
<li><strong>--rm</strong>: The test container will be removed after execution, not just stopped</li>
<li><strong>-p</strong>: Port forwardings. VNC is available on port 5901, the HTML5 webVNC view is exposed on port 6901 on the Docker host</li>
<li><strong>-e</strong>: Environment variable flag which is used to provide the <code>SAKULI_LICENSE_KEY</code> to the container</li>
<li><strong>&ndash;shm-size</strong>: <em>(Optional Parameter)</em> Increases the size of the shared memory space of the container. The default value is 64MB. This might be required when testing larger websites. Indicators that a shared memory enlargement is required are container crashes, the erroneous loading of websites or <code>invalid session id</code> errors due to crashed browsers.</li>
</ul>
<blockquote>
<p>Sakuli Test Containers run as non-root user, the default UID is 1000.</p>
</blockquote>
<h2 id="3-anatomy-of-a-containerized-sakuli-test">3 Anatomy of a Containerized Sakuli Test</h2>
<p>In general, the structure of a containerized Sakuli test does not differ from any other Sakuli test.
No changes are required when executing a test inside a container.
The only configuration we have to provide, is information about how and which tests should be executed.</p>
<h2 id="4-configuring-a-containerized-test">4 Configuring a Containerized Test</h2>
<p>The default behaviour of a Sakuli Test Container is to run <code>npm test</code> to execute tests,
so to run a custom test we have to:</p>
<ol>
<li>Provide the test project to the container (as shown in 4.2.X)</li>
<li>Specify the location of our test project inside the container</li>
<li>Configure what to execute on <code>npm test</code></li>
</ol>
<h3 id="41-provide-the-test-project-to-the-container">4.1 Provide the test project to the container</h3>
<p>There are two common ways to provide files to a container:</p>
<ul>
<li>Bind mounts</li>
<li>Extending a base image</li>
<li>Clone a git repository</li>
</ul>
<h4 id="411-bind-mounts">4.1.1 Bind Mounts</h4>
<p>When running a Docker container it is possible to mount a file or directory on the Docker host into a container.
This mechanism can be used to provide a Sakuli test to a test container:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -v /path/to/test/project/on/host:/sakuli_test -e SAKULI_LICENSE_KEY<span style="color:#f92672">=</span>&lt;YOUR SAKULI LICENSE KEY&gt; taconsol/sakuli:2.1.2</code></pre></div>
<p>By adding the <strong>-v</strong> parameter we&rsquo;re mounting the root folder of our Sakuli test at <code>/path/to/test/project/on/host</code> (where the <code>package.json</code> file is located) on our host machine at <code>/sakuli_test</code> inside our test container.
Inside the test container we can now run a Sakuli test via <code>sakuli run /sakuli_test/test_suite_folder</code>.</p>
<p>Bind mounts are easy to use and very useful during development.</p>
<p>For further information, please refer to the <!-- raw HTML omitted -->Docker documentation on bind mounts<!-- raw HTML omitted --></p>
<h4 id="412-extending-a-base-image">4.1.2 Extending a Base Image</h4>
<p>Once we finished our test case and are ready to put it to work, bind mounts might become a bit cumbersome.
Now that the test is done and wont change frequently, it would be feasible to build an explicit Docker image for our test.</p>
<p>We can do so by creating our own Dockerfile next to our project directory:</p>
<ul>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --> <strong>/folder/containing/Dockerfile/and/project</strong></li>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --> <strong>Dockerfile</strong></li>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --> <strong>testsuite-a</strong></li>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --> <strong>package.json</strong></li>
<li><!-- raw HTML omitted --><!-- raw HTML omitted --> <strong>&hellip;</strong></li>
</ul>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">FROM taconsol/sakuli:2.1.2

ADD ./testsuite-a <span style="color:#ae81ff">\$</span>HOME/sakuli_testsuite</code></pre></div>
<p>Using this Dockerfile we can now build our own test image by running</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker build -t name-of-my-image .</code></pre></div>
<p>inside the folder where our Dockerfile is located.</p>
<p>We can now run our newly built image via:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -e SAKULI_LICENSE_KEY<span style="color:#f92672">=</span>&lt;YOUR SAKULI LICENSE KEY&gt; name-of-my-image</code></pre></div>
<blockquote>
<p>When working with added files and folders inside a container, one has to ensure correct file permissions for added files.</p>
</blockquote>
<h4 id="413-clone-a-git-repository">4.1.3 Clone a git repository</h4>
<blockquote>
<p>Currently only available in our tech preview</p>
</blockquote>
<p>The Sakuli container provides a mechanism to clone a git repository at the container start and executing the sakuli project
within it:
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -e GIT_URL<span style="color:#f92672">=</span>&lt;REPOSITORY URL&gt; <span style="color:#f92672">[</span>-e GIT_CONTEXT_DIR<span style="color:#f92672">=</span>&lt;RELATIVE PATH TO TESTSUITE &gt;<span style="color:#f92672">]</span> -e SAKULI_LICENSE_KEY<span style="color:#f92672">=</span>&lt;YOUR SAKULI LICENSE KEY&gt; taconsol/sakuli:2.3.0</code></pre></div></p>
<p><code>GIT_URL</code> specifies the URL of the repository to be cloned. To access a private repository, please ensure, your git service provides the possibility to authenticate via URL parameters.
This is possible with common git services like <a href="https://docs.github.com/en/github/authenticating-to-github/creating-a-personal-access-token">GitHub</a>, <a href="https://docs.gitlab.com/ee/user/project/deploy_tokens/#git-clone-a-repository">Gitlab</a> and <a href="https://confluence.atlassian.com/bitbucketserver/personal-access-tokens-939515499.html?_ga=2.213635799.231132925.1597055610-1046501904.1597055610">Bitbucket</a>.
To authenticate with a token on GitHub, use: <code>https://&lt;token&gt;@github.com/&lt;username&gt;/&lt;repository.git&gt;</code>.</p>
<p><code>GIT_CONTEXT_DIR</code> is only necessary if the sakuli project is not located in the root directory of the cloned repository.</p>
<h3 id="42-specify-the-location-of-our-test-project-inside-the-container">4.2 Specify the location of our test project inside the container</h3>
<p>Now that our test files are available inside the container, we need to find a way to configure where our project is located.</p>
<p>This can easily be done by setting the <code>SAKULI_TEST_SUITE</code> environment variable to the respective path:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run -v /path/to/test/folder:/sakuli_test -e SAKULI_TEST_SUITE<span style="color:#f92672">=</span>/sakuli_test -e SAKULI_LICENSE_KEY<span style="color:#f92672">=</span>&lt;YOUR SAKULI LICENSE KEY&gt; taconsol/sakuli:2.1.2</code></pre></div>
<p>When building new images, this setting can also be added to the Dockerfile:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">FROM taconsol/sakuli:2.1.2

ADD ./testsuite-a $HOME/sakuli_testsuite
ENV SAKULI_TEST_SUITE<span style="color:#f92672">=</span>$HOME/sakuli_testsuite</code></pre></div>
<h3 id="43-configure-what-to-execute-on-npm-test">4.3 Configure what to execute on <code>npm test</code></h3>
<p>The main configuration file of a npm project is its <code>package.json</code> file.
Within this file it&rsquo;s possible to configure <!-- raw HTML omitted -->npm-scripts<!-- raw HTML omitted -->, a handy way to execute scripts inside an npm project.</p>
<p>An empty project initialised via <code>npm init</code> already contains one script: <code>npm test</code></p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#e6db74">&#34;scripts&#34;</span><span style="color:#f92672">:</span> {
<span style="color:#e6db74">&#34;test&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;echo \&#34;Error: no test specified\&#34; &amp;&amp; exit 1&#34;</span>
},
...
</code></pre></div>
<p><code>npm test</code> is the default way of executing tests in an npm project, so Sakuli tests should be executed this way, too!</p>
<p>Since Sakuli is available in our project, we can run our test by simply calling <code>sakuli run ...</code> on <code>npm test</code>.
Our test suites are located within the same folder as our <code>package.json</code>, so a test suite can be run via:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#e6db74">&#34;scripts&#34;</span><span style="color:#f92672">:</span> {
<span style="color:#e6db74">&#34;test&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;sakuli run /path/to/your/test/suite&#34;</span>
},
...
</code></pre></div>
<h4 id="431-troubleshooting">4.3.1 Troubleshooting</h4>
<p>This topic covers possible errors when running containerized Sakuli tests.</p>
<h4 id="4311-error-invalid-elf-header">4.3.1.1 Error: Invalid ELF header</h4>
<p>Some parts of Sakuli are platform-dependent, so the <code>node_modules</code> folder of a Sakuli project contains platform specific libs.
Sakuli containers are running a Linux base image, so when mounting a project which has been developed on a non Linux machine, e.g. macOS, the <code>node_modules</code> folder will contain libs specific to macOS.</p>
<p>Trying to run such a test inside a Sakuli container will therefore fail with an error message similar to this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">UnhandledPromiseRejectionWarning: Error: /test/node_modules/robotjs-node10/build/Release/robotjs.node: invalid ELF header</code></pre></div>
<p>A simple way to resolve the dependency problem is to delete the <code>node_modules</code> folder.
If your test project does not require libraries other than Sakuli, the correct libraries globally installed in Sakuli containers will be used.</p>
<p>In case your test project requires additional dependencies, it&rsquo;s possible to run <code>npm install</code> before executing the Sakuli test.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-js" data-lang="js">...
<span style="color:#e6db74">&#34;scripts&#34;</span><span style="color:#f92672">:</span> {
<span style="color:#e6db74">&#34;test&#34;</span><span style="color:#f92672">:</span> <span style="color:#e6db74">&#34;npm i &amp;&amp; sakuli run /path/to/your/test/suite&#34;</span>
},
...
</code></pre></div>
<h2 id="5-viewing--configuring-test-execution">5 Viewing / Configuring Test Execution</h2>
<p>Sakuli test containers allow to configure specific details of their runtime environment.</p>
<h3 id="51-vnc-access">5.1 VNC Access</h3>
<p>Sakuli containers provide access to running containers via VNC on ports 5901 and 6901.
By specifying port forwardings (<strong>-p</strong>) it is possible to configure which ports will be used to connect to a running container on the host system.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run --rm -p 5901:5901 -p 6901:6901 -e SAKULI_LICENSE_KEY<span style="color:#f92672">=</span>&lt;YOUR SAKULI LICENSE KEY&gt; taconsol/sakuli:2.1.2</code></pre></div>
<p>The example above forwards container ports 5901 and 6901 to the same ports on the host system.</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">docker run --rm -p 5000:5901 -p 6000:6901 -e SAKULI_LICENSE_KEY<span style="color:#f92672">=</span>&lt;YOUR SAKULI LICENSE KEY&gt; taconsol/sakuli:2.1.2</code></pre></div>
<p>In this example container port 5901 is forwarded to port 5000 on the host system, port 6901 is forwarded to port 6000 on the host system.
<code>localhost:5000</code> would be used to connect to the container via VNC client, on <code>localhost:6000</code> a webVNC view is available in the browser.</p>
<blockquote>
<p>The default password to access a container via VNC is <code>vncpassword</code>. It is <strong>highly** recommended to change this password in production environments. See section </strong>#5.2**<a href="#5-2-configuring-vnc-access"></a> for details</p>
</blockquote>
<h3 id="52-configuring-vnc-access">5.2 Configuring VNC Access</h3>
<p>The following VNC environment variables can be overwritten at the docker run phase to customize your desktop environment inside the container:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">VNC_COL_DEPTH, default: <span style="color:#ae81ff">24</span> // Color depth

VNC_RESOLUTION, default: 1280x1024 // Screen resolution

VNC_PW, default: vncpassword // VNC password

VNC_VIEW_ONLY, default: false // Run in view only mode, no keyboard / mouse interaction possible</code></pre></div>
<p>For example, the password for VNC could be set like this:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~<span style="color:#ae81ff">\$</span> docker run -p 5901:5901 -p 6901:6901 -e VNC_PW<span style="color:#f92672">=</span>my-new-password taconsol/sakuli:2.1.2</code></pre></div>
<h3 id="53-container-user">5.3 Container User</h3>
<p>Per default all container processes will be executed with user id 1000.</p>
<ul>
<li>
<p>Using root (user id 0):</p>
<pre><code>Add the \-\-user flag to your docker run command:

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  ~<span style="color:#ae81ff">\$</span> docker run -it -p 5901:5901 -p 6901:6901 --user <span style="color:#ae81ff">0</span> taconsol/sakuli:2.1.2
  </code></pre></div>
</code></pre>
</li>
<li>
<p>Using user and group id of host system</p>
<pre><code>Add the \-\-user flag to your docker run command:

<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">  ~$ docker run -it -p 5901:5901 -p 6901:6901 --user <span style="color:#66d9ef">$(</span>id -u<span style="color:#66d9ef">)</span>:<span style="color:#ae81ff">\$</span><span style="color:#f92672">(</span>id -g<span style="color:#f92672">)</span> taconsol/sakuli:2.1.2
  </code></pre></div>
</code></pre>
</li>
</ul>
<h2 id="6-custom-certificates">6 Custom Certificates</h2>
<p>Internal infrastructure often uses custom certificates with own root CAs etc.
Things like untrusted certificates cause Sakuli tests to fail, since no connection to an seemingly insecure host will be established (<code>InsecureCertificateError</code>).</p>
<p>Unfortunately, browsers use their own certificate store, which requires some additional work to add custom certificates.</p>
<h4 id="61-adding-custom-certificates">6.1 Adding Custom Certificates</h4>
<p>In order to add custom certificates to a Sakuli container, one has to provide two things:</p>
<ul>
<li>A directory containing certificates for import (_.crt, _.cer, *.pem)</li>
<li>An environment variable called <code>SAKULI_TRUSTED_CERT_DIR</code> which holds the path to the directory where certificates for import are located inside the container</li>
</ul>
<p>If the environment variable has been set, a startup script will pick up all certificates contained in the given folder and import each of them to all available browser certificate stores within <code>$HOME</code>, supporting both <code>cert8.db</code> databases for older browser versions as well as <code>cert9.db</code> files for recent browser versions.</p>
<h4 id="62-sample">6.2 Sample</h4>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-bash" data-lang="bash">~$ docker run -v /path/to/certificates/:/certificate_import -e SAKULI_TRUSTED_CERT_DIR<span style="color:#f92672">=</span>/certificate_import/ taconsol/sakuli:2.2.0</code></pre></div>
<h4 id="63-firefox">6.3 Firefox</h4>
<p>By default, a Firefox test uses a new, blank profile for each test run. In order to pick up the added certificates, a Firefox profile containing the appropriate certificate database has to be specified via <code>selenium.firefox.profile=/path/to/profile/folder</code> in <code>testsuite.properties</code>. In order to make this process easier, a dedicated Firefox profile for use with certificates is located at <code>/headless/firefox-certificates</code> to be used, instead of the generated profiles in <code>/headless/.mozilla/firefox/long_random_id.default</code>.</p>
<p><strong>Attention:</strong> If this property is not set, added certificates will have no effect.</p>
<h2 id="7-overview-environment-variables">7 Overview Environment Variables</h2>
<table>
<thead>
<tr>
<th>Environment Variable</th>
<th>Default Value</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>SAKULI_TEST_SUITE</td>
<td>$HOME/demo_testcase</td>
<td>Path to Sakuli testsuite to be executed</td>
</tr>
<tr>
<td>SAKULI_LICENSE_KEY</td>
<td></td>
<td>Sakuli license to use the container</td>
</tr>
<tr>
<td>VNC_COL_DEPTH</td>
<td>24</td>
<td>Color depth of container monitor</td>
</tr>
<tr>
<td>VNC_RESOLUTION</td>
<td>1280x1024</td>
<td>Screen resolution of container</td>
</tr>
<tr>
<td>VNC_PW</td>
<td>vncpassword</td>
<td>Password to access NoVNC/VNC connection</td>
</tr>
<tr>
<td>VNC_VIEW_ONLY</td>
<td>false</td>
<td>Enable/Disable view-only mode</td>
</tr>
<tr>
<td>NPM_TOKEN</td>
<td></td>
<td>NPM token to access npmjs.com registry</td>
</tr>
<tr>
<td>SAKULI_TRUSTED_CERT_DIR</td>
<td></td>
<td>Directory containing custom certificates for import</td>
</tr>
<tr>
<td>GIT_URL</td>
<td></td>
<td>URL of git repository</td>
</tr>
<tr>
<td>GIT_CONTEXT_DIR</td>
<td>.</td>
<td>Path to Sakuli testsuite within the git repository</td>
</tr>
</tbody>
</table>
<h2 id="8-summary">8 Summary</h2>
<p>Once we have</p>
<ul>
<li>added our test to the container (via <a href="#4-1-1-bind-mounts">bind mount</a> or <a href="#extending-a-base-image">our own image</a>)</li>
<li>configured where our test project is located (via <a href="#7-overview-environment-variables"><strong>SAKULI_TEST_SUITE environment variable</strong></a>)</li>
<li>set up our <a href="#4-3-configure-what-to-execute-on-npm-test"><strong>test script</strong></a></li>
<li>(optional) configured the container runtime environment</li>
</ul>
<p>our test will run automatically after the container started.</p>


<footer class=" footline" >
	
</footer>


        
        </div> 
        

      </div>

    <div id="navigation">
        
        
        
        
            
            
                
                    
                    
                
                

                    
                    
                        
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                        
                        
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
                        
            
            
                
                    
                
                

                    
                    
                    

                    
            
        
                    
            
        
                    
            
        
        
        


	 
	 
		
			<a class="nav nav-prev" href="/docs/enterprise_features/omd/" title="OMD Forwarder"> <i class="fa fa-chevron-left"></i></a>
		
		
			<a class="nav nav-next" href="/docs/enterprise_features/s2i/" title="S2I Image" style="margin-right: 0px;"><i class="fa fa-chevron-right"></i></a>
		
	
    </div>

    </section>
    
    <div style="left: -1000px; overflow: scroll; position: absolute; top: -1000px; border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;">
      <div style="border: none; box-sizing: content-box; height: 200px; margin: 0px; padding: 0px; width: 200px;"></div>
    </div>
    <script src="/docs/js/clipboard.min.js"></script>
    <script src="/docs/js/perfect-scrollbar.min.js"></script>
    <script src="/docs/js/perfect-scrollbar.jquery.min.js"></script>
    <script src="/docs/js/jquery.sticky.js"></script>
    <script src="/docs/js/featherlight.min.js"></script>
    <script src="/docs/js/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>
    <script src="/docs/js/modernizr.custom-3.6.0.js"></script>
    <script src="/docs/js/learn.js"></script>
    <script src="/docs/js/hugo-learn.js"></script>
    <script src="/docs/js/klaroCookie/config.js"></script>
    <script src="/docs/js/klaroCookie/klaro.js"></script>

    <link href="/docs/mermaid/mermaid.css" rel="stylesheet" />
    <script src="/docs/mermaid/mermaid.js"></script>
    <script>
        mermaid.initialize({ startOnLoad: true });
    </script>
    

  </body>
</html>

